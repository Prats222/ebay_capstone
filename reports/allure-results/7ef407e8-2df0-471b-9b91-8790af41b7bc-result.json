{"name": "Verify user login on eBay (strict ‚Äî fail on CAPTCHA/loop)", "status": "failed", "statusDetails": {"message": "Failed: Login failed ‚Äî account UI not detected after sign-in attempt. See saved screenshot + HTML for evidence.", "trace": "setup_driver = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"b3fc503fdd22715194ad0869bc16e029\")>\n\n    @allure.epic(\"E-Commerce Testing\")\n    @allure.feature(\"User Login\")\n    @allure.story(\"Login functionality verification (strict)\")\n    @allure.severity(allure.severity_level.CRITICAL)\n    @allure.title(\"Verify user login on eBay (strict ‚Äî fail on CAPTCHA/loop)\")\n    def test_user_login(setup_driver):\n        \"\"\"\n        Strict login test:\n          - reads credentials from .env\n          - attempts login, handles captcha by waiting (manual) up to CAPTCHA_WAIT_TIMEOUT_SECONDS\n          - verifies success strictly; if not successful -> fail with screenshot + page html\n        \"\"\"\n        driver = setup_driver\n        wait = WebDriverWait(driver, 15)\n    \n        EMAIL = os.getenv(\"EBAY_EMAIL\")\n        PASSWORD = os.getenv(\"EBAY_PASSWORD\")\n    \n        if not EMAIL or not PASSWORD:\n            pytest.skip(\"‚ö†Ô∏è Please set EBAY_EMAIL and EBAY_PASSWORD in your .env file.\")\n    \n        # navigate to signin\n        try:\n            driver.get(\"https://signin.ebay.com/\")\n        except Exception:\n            pytest.fail(\"Could not open eBay signin URL.\")\n    \n        # Use the robust pre-email wait & enter helper (handles pre-captcha, reloads and retries)\n        _pre_email_wait_and_enter(driver, EMAIL)\n    \n        # If captcha/verification occurs after entering email ‚Äî wait for manual solve (strict)\n        if _has_captcha(driver):\n            print(\"‚ö†Ô∏è CAPTCHA detected after entering email. Please solve it manually in the opened browser.\")\n            start = time.time()\n            solved = False\n            while time.time() - start < CAPTCHA_WAIT_TIMEOUT_SECONDS:\n                if not _has_captcha(driver):\n                    # sometimes after solving captcha, the signin page may reload ‚Äî break to re-evaluate\n                    solved = True\n                    break\n                time.sleep(CAPTCHA_POLL_INTERVAL)\n            if not solved:\n                png, html = _save_debug(driver, prefix=\"login_captcha\")\n                try:\n                    allure.attach.file(png, name=\"captcha_screenshot\", attachment_type=allure.attachment_type.PNG)\n                    allure.attach.file(html, name=\"captcha_page\", attachment_type=allure.attachment_type.HTML)\n                except Exception:\n                    pass\n                pytest.fail(f\"CAPTCHA detected and not solved within {CAPTCHA_WAIT_TIMEOUT_SECONDS} seconds. Saved {png} and {html} as evidence.\")\n    \n        # If \"Oops\" banner present ‚Äî optionally retry email once slowly\n        if _email_oops_present(driver) and EMAIL_RETRY_ON_OOPS:\n            print(\"üîÅ Email error banner seen ‚Äî retrying email once slowly.\")\n            time.sleep(1)\n            _pre_email_wait_and_enter(driver, EMAIL)\n            time.sleep(1)\n    \n        # Wait for password field (if not present, fail)\n        try:\n            wait.until(EC.presence_of_element_located((By.ID, \"pass\")))\n        except Exception:\n            # If there's no password field, bail and capture evidence\n            png, html = _save_debug(driver, prefix=\"login_no_pass\")\n            try:\n                allure.attach.file(png, name=\"no_pass_screenshot\", attachment_type=allure.attachment_type.PNG)\n                allure.attach.file(html, name=\"no_pass_page\", attachment_type=allure.attachment_type.HTML)\n            except Exception:\n                pass\n            pytest.fail(\"Password step not visible after email entry. See saved screenshot and page HTML.\")\n    \n        # Enter password (robust) and submit\n        try:\n            pw = driver.find_element(By.ID, \"pass\")\n            try:\n                driver.execute_script(\"arguments[0].scrollIntoView({block:'center'});\", pw)\n            except Exception:\n                pass\n            try:\n                pw.clear()\n                pw.send_keys(PASSWORD)\n            except ElementNotInteractableException:\n                # fallback JS setter\n                driver.execute_script(\"\"\"\n                    const el = arguments[0]; const v = arguments[1];\n                    el.value = v;\n                    el.dispatchEvent(new Event('input', { bubbles: true }));\n                    el.dispatchEvent(new Event('change', { bubbles: true }));\n                \"\"\", pw, PASSWORD)\n        except Exception:\n            png, html = _save_debug(driver, prefix=\"login_pw_find_failed\")\n            try:\n                allure.attach.file(png, name=\"pw_find_failed\", attachment_type=allure.attachment_type.PNG)\n                allure.attach.file(html, name=\"pw_find_failed_html\", attachment_type=allure.attachment_type.HTML)\n            except Exception:\n                pass\n            pytest.fail(\"Could not find or populate password field.\")\n    \n        # Click sign in button reliably\n        try:\n            try:\n                sign_in_btn = driver.find_element(By.ID, \"sgnBt\")\n            except Exception:\n                sign_in_btn = driver.find_element(By.XPATH, \"//button[@type='submit' or contains(., 'Sign in')]\")\n            try:\n                sign_in_btn.click()\n            except Exception:\n                driver.execute_script(\"arguments[0].click();\", sign_in_btn)\n        except Exception:\n            png, html = _save_debug(driver, prefix=\"login_click_failed\")\n            try:\n                allure.attach.file(png, name=\"login_click_failed\", attachment_type=allure.attachment_type.PNG)\n                allure.attach.file(html, name=\"login_click_failed_html\", attachment_type=allure.attachment_type.HTML)\n            except Exception:\n                pass\n            pytest.fail(\"Could not click Sign in button.\")\n    \n        # Now strictly verify logged in\n        if _verify_logged_in_strict(driver, timeout=VERIFY_LOGIN_TIMEOUT):\n            # success: save screenshot for proof\n            try:\n                ts = datetime.datetime.now().strftime(\"%Y%m%d_%H%M%S\")\n                s = f\"tests/login_success_{ts}.png\"\n                driver.save_screenshot(s)\n                try:\n                    allure.attach.file(s, name=\"login_success\", attachment_type=allure.attachment_type.PNG)\n                except Exception:\n                    pass\n                print(\"‚úÖ Login successful ‚Äî saved screenshot:\", s)\n            except Exception:\n                pass\n            assert True\n        else:\n            png, html = _save_debug(driver, prefix=\"login_failed_final\")\n            try:\n                allure.attach.file(png, name=\"login_failed_final_screenshot\", attachment_type=allure.attachment_type.PNG)\n                allure.attach.file(html, name=\"login_failed_final_html\", attachment_type=allure.attachment_type.HTML)\n            except Exception:\n                pass\n>           pytest.fail(\"Login failed ‚Äî account UI not detected after sign-in attempt. See saved screenshot + HTML for evidence.\")\nE           Failed: Login failed ‚Äî account UI not detected after sign-in attempt. See saved screenshot + HTML for evidence.\n\ntests\\test_login.py:447: Failed"}, "description": "\n    Strict login test:\n      - reads credentials from .env\n      - attempts login, handles captcha by waiting (manual) up to CAPTCHA_WAIT_TIMEOUT_SECONDS\n      - verifies success strictly; if not successful -> fail with screenshot + page html\n    ", "attachments": [{"name": "login_failed_final_screenshot", "source": "95b86a5d-7213-4961-bac7-99a60882a814-attachment.png", "type": "image/png"}, {"name": "login_failed_final_html", "source": "a018b337-8998-4325-9321-fdb18aadd925-attachment.html", "type": "text/html"}, {"name": "stdout", "source": "230830a7-0b90-442d-bb4b-92b69a7bb5ae-attachment.txt", "type": "text/plain"}], "start": 1763121710579, "stop": 1763121755545, "uuid": "2ea62ca4-0edf-4413-894c-8b6609ba82e2", "historyId": "0bbebac222397b93d463e6822fa79e9c", "testCaseId": "0bbebac222397b93d463e6822fa79e9c", "fullName": "tests.test_login#test_user_login", "labels": [{"name": "story", "value": "Login functionality verification (strict)"}, {"name": "feature", "value": "User Login"}, {"name": "severity", "value": "critical"}, {"name": "epic", "value": "E-Commerce Testing"}, {"name": "parentSuite", "value": "tests"}, {"name": "suite", "value": "test_login"}, {"name": "host", "value": "ASCINLAP61413"}, {"name": "thread", "value": "30032-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "tests.test_login"}], "titlePath": ["tests", "test_login.py"]}